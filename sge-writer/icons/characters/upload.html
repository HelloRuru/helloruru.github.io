<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SGE æ–‡æ¡ˆåŠ©æ‰‹ - è§’è‰²ç«‹ç¹ªä¸Šå‚³</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --rose: #D4A5A5;
      --lavender: #B8A9C9;
      --sage: #A8B5A0;
      --text: #333333;
      --text-light: #888888;
      --bg: #FAFAFA;
      --card-bg: #FFFFFF;
      --border: #E8E4E1;
      --success: #A8B5A0;
    }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 40px 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--rose), var(--lavender));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      text-align: center;
      color: var(--text-light);
      margin-bottom: 32px;
    }

    /* æª”åè¦å‰‡ */
    .naming-rules {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .naming-rules h2 {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 16px;
    }

    .rules-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .rules-table th {
      text-align: left;
      padding: 10px 12px;
      background: var(--bg);
      font-weight: 500;
    }

    .rules-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }

    .rules-table tr:last-child td {
      border-bottom: none;
    }

    .rules-table code {
      background: var(--bg);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
    }

    .color-dot {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      vertical-align: middle;
    }

    .color-dot.rose { background: var(--rose); }
    .color-dot.lavender { background: var(--lavender); }
    .color-dot.sage { background: var(--sage); }

    /* å¤§ä¸Šå‚³å€ */
    .upload-zone {
      background: var(--card-bg);
      border: 3px dashed var(--border);
      border-radius: 24px;
      padding: 60px 40px;
      text-align: center;
      margin-bottom: 24px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: var(--rose);
      background: rgba(212, 165, 165, 0.05);
    }

    .upload-zone input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .upload-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .upload-title {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .upload-desc {
      color: var(--text-light);
      font-size: 14px;
    }

    .upload-desc strong {
      color: var(--rose);
    }

    /* é€²åº¦ */
    .progress-section {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .progress-header h2 {
      font-size: 18px;
      font-weight: 500;
    }

    .progress-count {
      font-size: 14px;
      color: var(--text-light);
    }

    .progress-bar {
      background: var(--bg);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--rose), var(--lavender));
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    /* é è¦½æ ¼å­ */
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .preview-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .preview-slot {
      background: var(--bg);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      position: relative;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .preview-slot.filled {
      background: rgba(168, 181, 160, 0.1);
      border-color: var(--success);
    }

    .preview-slot.guide { border-left: 4px solid var(--rose); }
    .preview-slot.writer { border-left: 4px solid var(--lavender); }
    .preview-slot.player { border-left: 4px solid var(--sage); }

    .preview-img {
      width: 80%;
      height: 60%;
      object-fit: contain;
      border-radius: 8px;
      background: white;
    }

    .preview-info {
      margin-top: 8px;
    }

    .preview-role {
      font-size: 12px;
      font-weight: 500;
      color: var(--text);
    }

    .preview-emotion {
      font-size: 11px;
      color: var(--text-light);
    }

    .preview-filename {
      font-size: 9px;
      color: var(--text-light);
      font-family: monospace;
      margin-top: 2px;
    }

    .preview-empty {
      color: var(--border);
      font-size: 32px;
    }

    .preview-remove {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      display: none;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .preview-slot.filled:hover .preview-remove {
      display: flex;
    }

    /* æ“ä½œæŒ‰éˆ• */
    .actions {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 14px 28px;
      border-radius: 24px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--rose), var(--lavender));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(212, 165, 165, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg);
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 48px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
      color: var(--text-light);
      font-size: 14px;
    }

    footer a {
      color: var(--rose);
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>SGE æ–‡æ¡ˆåŠ©æ‰‹ â€” è§’è‰²ç«‹ç¹ªä¸Šå‚³</h1>
    <p class="subtitle">ä¸€æ¬¡ä¸Ÿå…¥å…¨éƒ¨ 12 å¼µ PNGï¼Œç³»çµ±è‡ªå‹•æ ¹æ“šæª”ååˆ†é¡</p>

    <!-- æª”åè¦å‰‡ -->
    <div class="naming-rules">
      <h2>ğŸ“‹ æª”åå°ç…§è¡¨ï¼ˆç³»çµ±æœƒè‡ªå‹•è¾¨è­˜ï¼‰</h2>
      <table class="rules-table">
        <tr>
          <th>è§’è‰²</th>
          <th>æª”åé—œéµå­—</th>
          <th>è¡¨æƒ…</th>
          <th>ç¯„ä¾‹æª”å</th>
        </tr>
        <tr>
          <td><span class="color-dot rose"></span>æ–‡æ¡ˆå°C</td>
          <td><code>guide</code> <code>å°c</code> <code>c-</code></td>
          <td rowspan="3">
            <code>joy</code> æ¨‚<br>
            <code>happy</code> å–œ<br>
            <code>angry</code> æ€’<br>
            <code>sad</code> å“€
          </td>
          <td><code>guide-joy.png</code></td>
        </tr>
        <tr>
          <td><span class="color-dot lavender"></span>å“ˆçš®</td>
          <td><code>writer</code> <code>å“ˆçš®</code> <code>h-</code></td>
          <td><code>writer-happy.png</code></td>
        </tr>
        <tr>
          <td><span class="color-dot sage"></span>éœ²éœ²</td>
          <td><code>player</code> <code>éœ²éœ²</code> <code>l-</code></td>
          <td><code>player-sad.png</code></td>
        </tr>
      </table>
    </div>

    <!-- å¤§ä¸Šå‚³å€ -->
    <div class="upload-zone" id="uploadZone" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
      <div class="upload-icon">ğŸ“</div>
      <div class="upload-title">æŠŠ 12 å¼µ PNG å…¨éƒ¨ä¸Ÿé€²ä¾†</div>
      <div class="upload-desc">æ‹–æ”¾æª”æ¡ˆæˆ– <strong>é»æ“Šé¸æ“‡</strong>ï¼ˆ512Ã—512 é€æ˜èƒŒæ™¯ PNGï¼‰</div>
      <input type="file" accept="image/png" multiple onchange="handleFiles(this.files)">
    </div>

    <!-- é€²åº¦èˆ‡é è¦½ -->
    <div class="progress-section">
      <div class="progress-header">
        <h2>ğŸ“¦ ä¸Šå‚³é€²åº¦</h2>
        <span class="progress-count" id="progressCount">0 / 12 å¼µ</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>

      <div class="preview-grid" id="previewGrid">
        <!-- æ¨‚ Joy -->
        <div class="preview-slot guide" data-role="guide" data-emotion="joy">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">æ–‡æ¡ˆå°C</div>
            <div class="preview-emotion">æ¨‚ Joy</div>
          </div>
        </div>
        <div class="preview-slot writer" data-role="writer" data-emotion="joy">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">å“ˆçš®</div>
            <div class="preview-emotion">æ¨‚ Joy</div>
          </div>
        </div>
        <div class="preview-slot player" data-role="player" data-emotion="joy">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">éœ²éœ²</div>
            <div class="preview-emotion">æ¨‚ Joy</div>
          </div>
        </div>

        <!-- å–œ Happy -->
        <div class="preview-slot guide" data-role="guide" data-emotion="happy">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">æ–‡æ¡ˆå°C</div>
            <div class="preview-emotion">å–œ Happy</div>
          </div>
        </div>
        <div class="preview-slot writer" data-role="writer" data-emotion="happy">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">å“ˆçš®</div>
            <div class="preview-emotion">å–œ Happy</div>
          </div>
        </div>
        <div class="preview-slot player" data-role="player" data-emotion="happy">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">éœ²éœ²</div>
            <div class="preview-emotion">å–œ Happy</div>
          </div>
        </div>

        <!-- æ€’ Angry -->
        <div class="preview-slot guide" data-role="guide" data-emotion="angry">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">æ–‡æ¡ˆå°C</div>
            <div class="preview-emotion">æ€’ Angry</div>
          </div>
        </div>
        <div class="preview-slot writer" data-role="writer" data-emotion="angry">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">å“ˆçš®</div>
            <div class="preview-emotion">æ€’ Angry</div>
          </div>
        </div>
        <div class="preview-slot player" data-role="player" data-emotion="angry">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">éœ²éœ²</div>
            <div class="preview-emotion">æ€’ Angry</div>
          </div>
        </div>

        <!-- å“€ Sad -->
        <div class="preview-slot guide" data-role="guide" data-emotion="sad">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">æ–‡æ¡ˆå°C</div>
            <div class="preview-emotion">å“€ Sad</div>
          </div>
        </div>
        <div class="preview-slot writer" data-role="writer" data-emotion="sad">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">å“ˆçš®</div>
            <div class="preview-emotion">å“€ Sad</div>
          </div>
        </div>
        <div class="preview-slot player" data-role="player" data-emotion="sad">
          <div class="preview-empty">+</div>
          <div class="preview-info">
            <div class="preview-role">éœ²éœ²</div>
            <div class="preview-emotion">å“€ Sad</div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ“ä½œæŒ‰éˆ• -->
    <div class="actions">
      <button class="btn btn-secondary" onclick="clearAll()">æ¸…é™¤å…¨éƒ¨</button>
      <button class="btn btn-primary" id="downloadBtn" onclick="downloadAll()" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        ä¸‹è¼‰ ZIPï¼ˆæ­£ç¢ºæª”åï¼‰
      </button>
    </div>

    <footer>
      <p>Â© 2026 Kaoru Tsai. All Rights Reserved. | Contact: <a href="mailto:hello@helloruru.com">hello@helloruru.com</a></p>
      <p style="margin-top: 8px;">
        <a href="../../docs/character-design.md" target="_blank">æŸ¥çœ‹å®Œæ•´è§’è‰²è¨­è¨ˆéœ€æ±‚æ–‡ä»¶</a>
      </p>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    const uploadedFiles = new Map();
    const roles = ['guide', 'writer', 'player'];
    const emotions = ['joy', 'happy', 'angry', 'sad'];

    // å¾æª”åçŒœè§’è‰²
    function guessRole(filename) {
      const lower = filename.toLowerCase();
      if (lower.includes('guide') || lower.includes('å°c') || lower.includes('c-') || lower.includes('navigator')) return 'guide';
      if (lower.includes('writer') || lower.includes('å“ˆçš®') || lower.includes('h-') || lower.includes('bard')) return 'writer';
      if (lower.includes('player') || lower.includes('éœ²éœ²') || lower.includes('l-') || lower.includes('lulu')) return 'player';
      return null;
    }

    // å¾æª”åçŒœè¡¨æƒ…
    function guessEmotion(filename) {
      const lower = filename.toLowerCase();
      if (lower.includes('joy') || lower.includes('æ¨‚') || lower.includes('smile') || lower.includes('normal')) return 'joy';
      if (lower.includes('happy') || lower.includes('å–œ') || lower.includes('cheer') || lower.includes('yay')) return 'happy';
      if (lower.includes('angry') || lower.includes('æ€’') || lower.includes('mad') || lower.includes('warn')) return 'angry';
      if (lower.includes('sad') || lower.includes('å“€') || lower.includes('cry') || lower.includes('worry')) return 'sad';
      return null;
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('dragover');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('dragover');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    }

    function handleFiles(files) {
      const pngFiles = Array.from(files).filter(f => f.type === 'image/png');

      if (pngFiles.length === 0) {
        alert('è«‹ä¸Šå‚³ PNG æ ¼å¼çš„åœ–ç‰‡');
        return;
      }

      // å–å¾—æ‰€æœ‰ç©ºä½
      const emptySlots = [];
      for (const emotion of emotions) {
        for (const role of roles) {
          const key = `${role}-${emotion}.png`;
          if (!uploadedFiles.has(key)) {
            emptySlots.push({ role, emotion, key });
          }
        }
      }

      pngFiles.forEach((file, index) => {
        const role = guessRole(file.name);
        const emotion = guessEmotion(file.name);

        let targetKey = null;

        // å¦‚æœéƒ½çŒœåˆ°äº†ï¼Œç›´æ¥ç”¨
        if (role && emotion) {
          targetKey = `${role}-${emotion}.png`;
        }
        // åªçŒœåˆ°è§’è‰²ï¼Œæ‰¾è©²è§’è‰²çš„ç©ºä½
        else if (role) {
          const slot = emptySlots.find(s => s.role === role);
          if (slot) targetKey = slot.key;
        }
        // åªçŒœåˆ°è¡¨æƒ…ï¼Œæ‰¾è©²è¡¨æƒ…çš„ç©ºä½
        else if (emotion) {
          const slot = emptySlots.find(s => s.emotion === emotion);
          if (slot) targetKey = slot.key;
        }
        // éƒ½çŒœä¸åˆ°ï¼Œç”¨ä¸‹ä¸€å€‹ç©ºä½
        else {
          if (emptySlots.length > 0) {
            targetKey = emptySlots[0].key;
          }
        }

        if (targetKey && !uploadedFiles.has(targetKey)) {
          uploadedFiles.set(targetKey, file);

          // å¾ç©ºä½ç§»é™¤
          const idx = emptySlots.findIndex(s => s.key === targetKey);
          if (idx > -1) emptySlots.splice(idx, 1);

          // æ›´æ–° UI
          const [r, e] = targetKey.replace('.png', '').split('-');
          updateSlot(r, e, file);
        }
      });

      updateProgress();
    }

    function updateSlot(role, emotion, file) {
      const slot = document.querySelector(`.preview-slot[data-role="${role}"][data-emotion="${emotion}"]`);
      if (!slot) return;

      slot.classList.add('filled');

      // æ¸…é™¤èˆŠå…§å®¹
      const oldImg = slot.querySelector('.preview-img');
      const oldEmpty = slot.querySelector('.preview-empty');
      if (oldImg) oldImg.remove();
      if (oldEmpty) oldEmpty.remove();

      // æ–°å¢é è¦½
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = document.createElement('img');
        img.className = 'preview-img';
        img.src = e.target.result;
        slot.insertBefore(img, slot.firstChild);
      };
      reader.readAsDataURL(file);

      // æ–°å¢åˆªé™¤æŒ‰éˆ•
      let removeBtn = slot.querySelector('.preview-remove');
      if (!removeBtn) {
        removeBtn = document.createElement('button');
        removeBtn.className = 'preview-remove';
        removeBtn.textContent = 'Ã—';
        removeBtn.onclick = (e) => {
          e.stopPropagation();
          removeFile(role, emotion);
        };
        slot.appendChild(removeBtn);
      }

      // é¡¯ç¤ºåŸå§‹æª”å
      let fnEl = slot.querySelector('.preview-filename');
      if (!fnEl) {
        fnEl = document.createElement('div');
        fnEl.className = 'preview-filename';
        slot.querySelector('.preview-info').appendChild(fnEl);
      }
      fnEl.textContent = `â† ${file.name}`;
    }

    function removeFile(role, emotion) {
      const key = `${role}-${emotion}.png`;
      uploadedFiles.delete(key);

      const slot = document.querySelector(`.preview-slot[data-role="${role}"][data-emotion="${emotion}"]`);
      slot.classList.remove('filled');

      const img = slot.querySelector('.preview-img');
      if (img) img.remove();

      const removeBtn = slot.querySelector('.preview-remove');
      if (removeBtn) removeBtn.remove();

      const fnEl = slot.querySelector('.preview-filename');
      if (fnEl) fnEl.remove();

      // é‡æ–°åŠ å…¥ç©ºç™½
      const empty = document.createElement('div');
      empty.className = 'preview-empty';
      empty.textContent = '+';
      slot.insertBefore(empty, slot.firstChild);

      updateProgress();
    }

    function updateProgress() {
      const count = uploadedFiles.size;
      const percent = (count / 12) * 100;

      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('progressCount').textContent = `${count} / 12 å¼µ`;
      document.getElementById('downloadBtn').disabled = count === 0;
    }

    function clearAll() {
      if (uploadedFiles.size === 0) return;
      if (!confirm('ç¢ºå®šè¦æ¸…é™¤å…¨éƒ¨å—ï¼Ÿ')) return;

      uploadedFiles.clear();

      document.querySelectorAll('.preview-slot').forEach(slot => {
        slot.classList.remove('filled');

        const img = slot.querySelector('.preview-img');
        if (img) img.remove();

        const removeBtn = slot.querySelector('.preview-remove');
        if (removeBtn) removeBtn.remove();

        const fnEl = slot.querySelector('.preview-filename');
        if (fnEl) fnEl.remove();

        let empty = slot.querySelector('.preview-empty');
        if (!empty) {
          empty = document.createElement('div');
          empty.className = 'preview-empty';
          empty.textContent = '+';
          slot.insertBefore(empty, slot.firstChild);
        }
      });

      document.querySelector('.upload-zone input').value = '';
      updateProgress();
    }

    async function downloadAll() {
      if (uploadedFiles.size === 0) return;

      const btn = document.getElementById('downloadBtn');
      btn.disabled = true;
      btn.innerHTML = 'â³ æ‰“åŒ…ä¸­...';

      try {
        const zip = new JSZip();

        for (const [filename, file] of uploadedFiles) {
          const buffer = await file.arrayBuffer();
          zip.file(filename, buffer);
        }

        const blob = await zip.generateAsync({ type: 'blob' });

        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'sge-writer-characters.zip';
        link.click();
        URL.revokeObjectURL(link.href);

        btn.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          ä¸‹è¼‰ ZIPï¼ˆæ­£ç¢ºæª”åï¼‰
        `;
        btn.disabled = false;
      } catch (err) {
        alert('æ‰“åŒ…å¤±æ•—ï¼š' + err.message);
        btn.innerHTML = 'ä¸‹è¼‰ ZIP';
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
