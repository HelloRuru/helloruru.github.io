<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIO View — AI Overview 監測工具</title>
  <meta name="description" content="監測你的網站文章是否出現在 Google AI Overview 摘要中">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="container">
        <h1 class="logo">AIO View</h1>
        <p class="tagline">監測你的文章是否出現在 Google AI Overview</p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <div class="container">

        <!-- Guide: 使用說明 -->
        <section class="card guide-card" id="guide-section">
          <button class="guide-header" id="guide-toggle" aria-expanded="true">
            <h2>
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
              使用說明
            </h2>
            <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6,9 12,15 18,9"/>
            </svg>
          </button>

          <div class="guide-content expanded" id="guide-content">
            <!-- 流程總覽 -->
            <div class="guide-flow">
              <div class="flow-step">
                <span class="flow-num">1</span>
                <span class="flow-text">輸入 Sitemap</span>
              </div>
              <svg class="flow-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
              <div class="flow-step">
                <span class="flow-num">2</span>
                <span class="flow-text">編輯搜尋語句</span>
              </div>
              <svg class="flow-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
              <div class="flow-step">
                <span class="flow-num">3</span>
                <span class="flow-text">本機執行 CLI</span>
              </div>
              <svg class="flow-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
              <div class="flow-step">
                <span class="flow-num">4</span>
                <span class="flow-text">上傳結果</span>
              </div>
            </div>

            <!-- 詳細說明 -->
            <div class="guide-details">
              <div class="guide-item">
                <h3>這是什麼工具？</h3>
                <p>AIO View 用來監測你的網站文章是否出現在 Google 搜尋的 <strong>AI Overview</strong>（AI 摘要）中。當使用者搜尋相關關鍵字時，Google 可能會顯示 AI 生成的摘要，並引用你的文章作為來源。</p>
              </div>

              <div class="guide-item">
                <h3>為什麼需要本機執行？</h3>
                <p>由於瀏覽器安全限制（CORS），網頁無法直接抓取 Google 搜尋結果。因此需要在你的電腦上執行 CLI 工具，它會用 Playwright 模擬瀏覽器進行搜尋。</p>
              </div>

              <div class="guide-item">
                <h3>CLI 工具需求</h3>
                <ul>
                  <li><strong>Node.js 18+</strong> — <a href="https://nodejs.org/" target="_blank" rel="noopener">下載安裝</a></li>
                  <li><strong>Git</strong> — 用於下載工具</li>
                  <li>約 <strong>500MB</strong> 硬碟空間（Chromium 瀏覽器）</li>
                </ul>
              </div>

              <div class="guide-item">
                <h3>執行時間與注意事項</h3>
                <ul>
                  <li>每個搜尋間隔 <strong>2.5 分鐘</strong>，避免觸發 Google 反爬機制</li>
                  <li>50 篇文章約需 <strong>2 小時</strong>，建議睡前執行</li>
                  <li>執行過程中會看到瀏覽器自動開啟並搜尋</li>
                  <li>結果會即時儲存，中斷後可繼續</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 1: Input -->
        <section class="card" id="input-section">
          <h2>
            <span class="step-badge">1</span>
            輸入 Sitemap
          </h2>
          <div class="input-group">
            <input
              type="url"
              id="sitemap-url"
              placeholder="https://example.com/sitemap.xml"
              value="https://dailyshiru.com/sitemap.xml"
            >
            <button class="btn btn-primary" id="fetch-btn">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                <path d="M9 12l2 2 4-4"/>
              </svg>
              解析
            </button>
          </div>
          <p class="hint" id="fetch-status"></p>
        </section>

        <!-- Step 2: Articles List -->
        <section class="card hidden" id="articles-section">
          <h2>
            <span class="step-badge">2</span>
            文章清單
            <span class="count-badge" id="article-count">0</span>
          </h2>
          <p class="section-desc">自動產生搜尋語句，可手動編輯</p>

          <div class="table-wrapper">
            <table class="data-table" id="articles-table">
              <thead>
                <tr>
                  <th class="col-check"><input type="checkbox" id="select-all"></th>
                  <th class="col-title">文章標題</th>
                  <th class="col-query">搜尋語句</th>
                </tr>
              </thead>
              <tbody id="articles-body">
                <!-- Dynamic content -->
              </tbody>
            </table>
          </div>

          <div class="actions">
            <button class="btn btn-secondary" id="export-queries-btn">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              匯出搜尋語句
            </button>
            <button class="btn btn-primary" id="generate-cli-btn">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="4,17 10,11 4,5"/>
                <line x1="12" y1="19" x2="20" y2="19"/>
              </svg>
              產生 CLI 指令
            </button>
          </div>
        </section>

        <!-- Step 3: CLI Instructions -->
        <section class="card hidden" id="cli-section">
          <h2>
            <span class="step-badge">3</span>
            執行掃描
          </h2>
          <p class="section-desc">在本機執行以下指令，完成後上傳結果</p>

          <div class="code-block">
            <div class="code-header">
              <span>Terminal</span>
              <button class="btn-copy" id="copy-cli-btn">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                </svg>
                複製
              </button>
            </div>
            <pre id="cli-commands"></pre>
          </div>
        </section>

        <!-- Step 4: Upload Results -->
        <section class="card" id="upload-section">
          <h2>
            <span class="step-badge">4</span>
            上傳結果
          </h2>
          <div class="upload-zone" id="upload-zone">
            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
              <polyline points="17,8 12,3 7,8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <p>拖曳 <code>results.json</code> 到這裡</p>
            <p class="hint">或點擊選擇檔案</p>
            <input type="file" id="file-input" accept=".json" hidden>
          </div>
        </section>

        <!-- Results Dashboard -->
        <section class="card hidden" id="results-section">
          <h2>
            <span class="step-badge">5</span>
            監測結果
          </h2>

          <!-- Stats -->
          <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="stat-total">0</div>
              <div class="stat-label">總文章數</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-aio">0</div>
              <div class="stat-label">有 AIO</div>
            </div>
            <div class="stat-card stat-highlight">
              <div class="stat-value" id="stat-cited">0</div>
              <div class="stat-label">被引用</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-rate">0%</div>
              <div class="stat-label">引用率</div>
            </div>
          </div>

          <!-- Filter -->
          <div class="filter-bar">
            <button class="filter-btn active" data-filter="all">全部</button>
            <button class="filter-btn" data-filter="cited">被引用</button>
            <button class="filter-btn" data-filter="aio-not-cited">有 AIO 未引用</button>
            <button class="filter-btn" data-filter="no-aio">無 AIO</button>
          </div>

          <!-- Results Table -->
          <div class="table-wrapper">
            <table class="data-table" id="results-table">
              <thead>
                <tr>
                  <th class="col-title">文章</th>
                  <th class="col-query">搜尋語句</th>
                  <th class="col-status">AIO 狀態</th>
                  <th class="col-cited">被引用</th>
                </tr>
              </thead>
              <tbody id="results-body">
                <!-- Dynamic content -->
              </tbody>
            </table>
          </div>

          <!-- Export -->
          <div class="actions">
            <button class="btn btn-secondary" id="export-csv-btn">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
              </svg>
              匯出 CSV
            </button>
          </div>
        </section>

      </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
      <p>© <span id="footer-year"></span> Kaoru Tsai. All Rights Reserved. | Contact: <a href="mailto:hello@helloruru.com">hello@helloruru.com</a></p>
    </footer>
  </div>

  <!-- Scripts: Modules (載入順序很重要) -->
  <script src="js/modules/utils.js"></script>
  <script src="js/modules/toast.js"></script>
  <script src="js/modules/storage.js"></script>
  <script src="js/modules/sitemap.js"></script>

  <!-- Scripts: Components -->
  <script src="js/components/guide.js"></script>
  <script src="js/components/stats.js"></script>
  <script src="js/components/articles-table.js"></script>
  <script src="js/components/results-table.js"></script>
  <script src="js/components/file-upload.js"></script>
  <script src="js/components/cli-generator.js"></script>
  <script src="js/components/sitemap-input.js"></script>

  <!-- Scripts: Main Entry -->
  <script src="js/main.js"></script>
  <script>
    const startYear = 2026;
    const currentYear = new Date().getFullYear();
    document.getElementById('footer-year').textContent =
      currentYear > startYear ? `${startYear}–${currentYear}` : `${startYear}`;
  </script>
</body>
</html>
